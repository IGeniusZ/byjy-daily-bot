name: Daily Report Reminder (Mon-Sat)

on:
  schedule:
    # UTC 10:30 = åŒ—äº¬æ—¶é—´ 18:30ï¼Œä»…å‘¨ä¸€åˆ°å‘¨å…­ï¼ˆ1=å‘¨ä¸€, 6=å‘¨å…­ï¼‰
    - cron: '30 10 * * 1-6'
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨æµ‹è¯•

jobs:
  send-reminder:
    runs-on: ubuntu-latest
    steps:
      - name: Generate Chinese Weekday and Date
        id: date_info
        run: |
          WEEKDAY=$(date '+%u')  # 1=å‘¨ä¸€, 7=å‘¨æ—¥
          case $WEEKDAY in
            1) CN_DAY="å‘¨ä¸€" ;;
            2) CN_DAY="å‘¨äºŒ" ;;
            3) CN_DAY="å‘¨ä¸‰" ;;
            4) CN_DAY="å‘¨å››" ;;
            5) CN_DAY="å‘¨äº”" ;;
            6) CN_DAY="å‘¨å…­" ;;
            *) CN_DAY="å‘¨æ—¥" ;;
          esac
          DATE_STR=$(date '+%mæœˆ%dæ—¥')
          echo "cn_day=$CN_DAY" >> $GITHUB_ENV
          echo "date_str=$DATE_STR" >> $GITHUB_ENV

      - name: Send Template Card to WeCom
        env:
          WECHAT_KEY: ${{ secrets.WECHAT_BOT_YUQUE }}
        run: |
          # è¯­é›€æ—¥æŠ¥åœ°å€ï¼ˆå·²è§£ç ï¼Œç¡®ä¿å¯ç‚¹å‡»ï¼‰
          REPORT_URL="https://byjyedu.yuque.com/org-wiki-byjyedu-bxo6fa/bmqx33/gz2ixgatwha0u07k"

          # æ„é€  JSONï¼ˆæ³¨æ„è½¬ä¹‰åŒå¼•å·ï¼‰
          curl "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=$WECHAT_KEY" \
            -H 'Content-Type: application/json' \
            -d '{
              "msgtype": "template_card",
              "template_card": {
                "card_type": "text_notice",
                "source": {
                  "icon_url": "https://gw.alipayobjects.com/zos/bmw-prod/501b3e5b-8924-45cd-95ee-4c7470570204.svg",
                  "desc": "æŠ€æœ¯ä¸­å¿ƒ Â· æ—¥æŠ¥å¡«å†™"
                },
                "main_title": {
                  "title": "â° æ—¥æŠ¥æäº¤æé†’",
                  "desc": "'"$DATE_STR"' '"$CN_DAY"' Â· 19:00 æˆªæ­¢"
                },
                "quote_area": {
                  "type": 1,
                  "quote_text": "è¯·å®Œæ•´å¡«å†™ï¼šä»Šæ—¥å·¥ä½œè¿›å±•ã€‚"
                },
                "emphasis_content": {
                  "title": "ç«‹å³æäº¤",
                  "desc": "ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¿«é€Ÿè¿›å…¥"
                },
                "horizontal_content_list": [
                  {
                    "keyname": "æˆªæ­¢æ—¶é—´",
                    "value": "19:00"
                  },
                  {
                    "keyname": "æé†’å¯¹è±¡",
                    "value": "@all"
                  }
                ],
                "jump_list": [
                  {
                    "type": 1,
                    "url": "'"$REPORT_URL'",
                    "title": "ğŸ“ æ‰“å¼€æ—¥æŠ¥"
                  }
                ]
              }
            }'
