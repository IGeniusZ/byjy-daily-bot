name: ğŸŒ¤ï¸ Morning Weather & 10:00 Check-in Reminder

on:
  schedule:
    - cron: '40 1 * * *'   # UTC 1:40 = åŒ—äº¬æ—¶é—´ 9:40
  workflow_dispatch:

jobs:
  weather-checkin:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸŒ¦ï¸ Get Weather and Send Beautiful Reminder
        env:
          WECHAT_KEY: ${{ secrets.WECHAT_BOT_KEY }}
          QWEATHER_KEY: ${{ secrets.QWEATHER_KEY }}
          LOCATION: "101280601"  # é»˜è®¤æ·±åœ³ï¼Œå¯æ›¿æ¢ä¸ºå…¶ä»–åŸå¸‚ID
        run: |
          # === è°ƒç”¨å’Œé£å¤©æ°” API ===
          response=$(curl -s "https://devapi.qweather.com/v7/weather/now?location=$LOCATION&key=$QWEATHER_KEY")
          temp=$(echo "$response" | jq -r '.now.temp // empty')
          text=$(echo "$response" | jq -r '.now.text // empty')
          feels_like=$(echo "$response" | jq -r '.now.feelsLike // empty')

          if [ -z "$temp" ] || [ "$temp" = "null" ]; then
            weather_block="ğŸŒ¤ï¸ <font color=\"comment\">å¤©æ°”ä¿¡æ¯æš‚ä¸å¯ç”¨</font>"
          else
            weather_block="ğŸŒ¡ï¸ **å½“å‰æ¸©åº¦**ï¼š${temp}Â°Cï¼ˆä½“æ„Ÿ ${feels_like}Â°Cï¼‰\nâ˜ï¸ **å¤©æ°”çŠ¶å†µ**ï¼š$text"
          fi

          # === æ„é€ è¶…å¥½çœ‹ Markdown æ¶ˆæ¯ ===
          curl "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=$WECHAT_KEY" \
            -H 'Content-Type: application/json' \
            -d '{
              "msgtype": "markdown",
              "markdown": {
                "content": "ğŸŒ¤ï¸ <font color=\"info\">â”€â”€â”€â”€â”€â”€ ğŸŒ æ—©å®‰æé†’ â”€â”€â”€â”€â”€â”€</font>\n\nğŸ“ **åŸå¸‚**ï¼šæ·±åœ³\n'$weather_block'\n\nâ° <font color=\"warning\">10:00 å‰è¯·å®Œæˆæ‰“å¡ï¼</font>\n> åˆ«è®©è€ƒå‹¤ç³»ç»Ÿç­‰ä½ å¤ªä¹…ï½\n\nâœ¨ ç¥ä½ ä»Šå¤©é«˜æ•ˆã€å°‘ä¼šã€æ—  bugï¼\n\n@all"
              }
            }'
