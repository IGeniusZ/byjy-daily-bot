name: Daily Weather

on:
  schedule:
    - cron: '30 0 * * *'  # åŒ—äº¬æ—¶é—´ 8:30
  workflow_dispatch:

jobs:
  weather:
    runs-on: ubuntu-latest
    steps:
      - name: Get Weather and Send
        env:
          WECHAT_KEY: ${{ secrets.WECHAT_BOT_KEY }}
          QWEATHER_KEY: ${{ secrets.QWEATHER_KEY }}  # åœ¨ Secrets ä¸­æ·»åŠ 
          LOCATION: "101280601"  # æ·±åœ³çš„ location idï¼Œå¯æŸ¥å®˜ç½‘
        run: |
          # è°ƒç”¨å’Œé£å¤©æ°” API
          response=$(curl -s "https://devapi.qweather.com/v7/weather/now?location=$LOCATION&key=$QWEATHER_KEY")
          temp=$(echo "$response" | jq -r '.now.temp')
          text=$(echo "$response" | jq -r '.now.text')
          feels_like=$(echo "$response" | jq -r '.now.feelsLike')
          
          if [ -z "$temp" ] || [ "$temp" = "null" ]; then
            msg="ğŸŒ¤ï¸ ä»Šæ—¥å¤©æ°”è·å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥ API Key"
          else
            msg="ğŸŒ¡ï¸ å½“å‰æ¸©åº¦ï¼š${temp}Â°Cï¼ˆä½“æ„Ÿ ${feels_like}Â°Cï¼‰\nâ˜ï¸ å¤©æ°”ï¼š$text"
          fi

          curl "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=$WECHAT_KEY" \
            -H 'Content-Type: application/json' \
            -d "{
              \"msgtype\": \"markdown\",
              \"markdown\": {
                \"content\": \"<font color=\"info\">ğŸŒ¦ï¸ æ·±åœ³ä»Šæ—¥å¤©æ°”</font>\n\n$msg\n\nå‡ºé—¨è®°å¾—å¸¦ä¼ or æ¶‚é˜²æ™’ï¼\"
              }
            }"
