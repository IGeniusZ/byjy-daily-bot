name: ğŸŒ™ ä¸‹ç­æ‰“å¡æé†’ï¼ˆå•ä¼‘ç‰ˆï¼‰

on:
  schedule:
    # UTC 11:00 = åŒ—äº¬æ—¶é—´ 19:00ï¼Œä»…å‘¨ä¸€åˆ°å‘¨å…­
    - cron: '0 11 * * 1-6'
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨æµ‹è¯•

jobs:
  off-duty-reminder:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸŒŸ å‘é€ä¸‹ç­æ‰“å¡æé†’
        env:
          WECHAT_KEY: ${{ secrets.WECHAT_BOT_KEY }}
        run: |
          # è·å–ä¸­æ–‡æ˜ŸæœŸå’Œæ—¥æœŸ
          WEEKDAY=$(date '+%u')
          case $WEEKDAY in
            1) CN_DAY="å‘¨ä¸€" ;;
            2) CN_DAY="å‘¨äºŒ" ;;
            3) CN_DAY="å‘¨ä¸‰" ;;
            4) CN_DAY="å‘¨å››" ;;
            5) CN_DAY="å‘¨äº”" ;;
            6) CN_DAY="å‘¨å…­" ;;
          esac
          DATE_STR=$(date '+%mæœˆ%dæ—¥')

          # ä¼ä¸šå¾®ä¿¡å®˜æ–¹æ‰“å¡é“¾æ¥ï¼ˆé€šç”¨å…¥å£ï¼‰
          PUNCH_URL="https://work.weixin.qq.com/wework_admin/portal/punch_in?from=notify"

          # å‘é€ Markdown æ¶ˆæ¯ï¼ˆæ¢è¡Œç”¨ \nï¼Œå•å¼•å·å†…ç›´æ¥å†™ï¼‰
          curl -s -X POST \
            "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=$WECHAT_KEY" \
            -H 'Content-Type: application/json' \
            -d '{
              "msgtype": "markdown",
              "markdown": {
                "content": "ğŸŒ™ <font color=\"info\">â”€â”€â”€â”€â”€â”€ â° ä¸‹ç­æ—¶é—´åˆ°ï¼â”€â”€â”€â”€â”€â”€</font>\n\nğŸ“Œ **ä»Šæ—¥**ï¼š'$DATE_STR'ï¼ˆ'$CN_DAY'ï¼‰\nğŸ“ **ä»»åŠ¡**ï¼š<font color=\"warning\">âœ… ç«‹å³æ‰“å¡ + æäº¤æ—¥æŠ¥</font>\n\nğŸ’¬ <font color=\"comment\">â€œä»Šå¤©ä¹Ÿè¦å¥½å¥½ä¼‘æ¯å‘€ï½â€</font>\n> â€”â€” æš–å¿ƒå°åŠ©æ‰‹\n\n[ğŸšª ç«‹å³æ‰“å¡]('$PUNCH_URL')\n\n@all"
              }
            }' >/dev/null || true

          exit 0
